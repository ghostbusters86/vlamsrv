var Reading=function(){var a={soal:baseURL+"user/soal/getAll",content:baseURL+"user/exam/content",image:baseURL+"user/soal/image",save:baseURL+"api/v2/soal/save"};return{soal:[],content:"",current:{},params:{mapel_id:"",tingkat:"",babon:""},start:function(){var t=this;$(window).keydown(function(a){var t=a.which;$(".soal-container").length>0&&(37==t?$("#soal-back").click():39==t&&$("#soal-next").click())}),t.params={mapel_id:$(".params").attr("data-mapel"),tingkat:$(".params").attr("data-tingkat"),babon:$(".params").attr("data-babon")},$.ajax({dataType:"json",type:"POST",url:a.soal,data:t.params,success:function(a){a.success&&(t.soal=a.rows,$.each(t.soal,function(a,t){var n=$("<a>",{href:"javascript:void(0)",class:"soal-nomor-link","data-index":a,"data-no":t.nomor,"data-soal-id":t.soal_id}).text(t.nomor);(n=$("<li>").append(n)).appendTo("#nomor-soal")}),$("#nomor-soal a").click(function(a){var n=$(this),s=$(this).data("index"),e=t.soal[s];t.current=e,$("#page").text(e.nomor),$(".soal-nomor-link").removeClass("active"),$(this).addClass("active"),$("#soal-next").show(),$("#soal-selesai").show(),$("#soal-ragu").hide(),$("#btnLogout").hide(),t.loadSoal(e,n)}),$("#nomor-soal a:first").click(),$("#page-count").text(t.soal.length),t.eventListener())}})},loadSoal:function(t,n){var s=this;$.ajax({dataType:"json",type:"POST",url:a.content,data:{soal_id:t.soal_id},success:function(t){if(t.success){var e=$("<div>",{class:"soal-container mce-content-body"});if("1"==t.images_soal){var i=$("<img>",{src:app.uri(a.image,{mapel_id:t.mapel_id,tingkat:t.tingkat,filename:t.filename}),onload:"this.width/=1.3;this.onload=null;",alt:"Loading Images........"});e.html(i),$("#content").html(e)}else $("#content").html(e.html(t.pertanyaan));$("#soal-selesai").html("SELESAI").append($("<span>",{class:"fa fa-check-circle"})).removeClass("btn-save"),$("#soal-edit").html("EDIT").append($("<span>",{class:"fa fa-edit"})).removeClass("btn-batal"),s.listenJawaban(n,e,t)}}})},eventListener:function(){var a=this;$("#font-small").click(function(){$(".soal-container").removeClass("zoom-1"),$(".soal-container").removeClass("zoom-2")}),$("#font-middle").click(function(){$(".soal-container").addClass("zoom-1"),$(".soal-container").removeClass("zoom-2")}),$("#font-big").click(function(){$(".soal-container").removeClass("zoom-1"),$(".soal-container").addClass("zoom-2")}),$("#soal-back").click(function(){var a=$("#page").text()-1,t=a-1;$("#page-count").text();a>0&&$("#nomor-soal a:eq("+t+")").click()}),$("#soal-next").click(function(){var a=$("#page").text()-1+1;a<$("#page-count").text()&&$("#nomor-soal a:eq("+a+")").click()}),$("#soal-selesai").click(function(){$(this).hasClass("btn-save")?a.onSave():parent.location=baseURL+"user/soal/show/"+a.params.mapel_id+"/"+a.params.tingkat+"/"+a.params.babon}),$("#right-nav-button").click(function(){$("#right-nav").hasClass("show")?($("#right-nav").removeClass("show"),$(this).find(".fa").removeClass("fa-chevron-right"),$(this).find(".fa").addClass("fa-chevron-left")):($("#right-nav").addClass("show"),$(this).find(".fa").removeClass("fa-chevron-left"),$(this).find(".fa").addClass("fa-chevron-right"))});var t=$("<button>",{id:"soal-edit",class:"btn btn-danger sesudah",text:"EDIT"}).append($("<span>",{class:"fa fa-edit"}));$(".button-wrapper").append(t),t.click(function(t){$(this).hasClass("btn-batal")?a.loadSoal(a.current,$("#nomor-soal").find("a.active")):(a.clearContent(),a.editSoal())})},editSoal:function(){var a=this;a.form=new Imat.Form({cols:"col-lg-9",items:[{xtype:"tinymce",title:"Pertanyaan",allowBlank:!1,dataIndex:"soal",value:a.conten,onLoad:function(){setTimeout(function(){$("iframe").contents().find("body").find("img").each(function(t,n){"blob"==$(this).attr("src").substring(0,4)&&a.convertBase64($(this))})},1e3)}}]}),$(".soal-container").hide(),$("#soal-selesai").html("SIMPAN").append($("<span>",{class:"fa fa-save"})).addClass("btn-save"),$("#soal-edit").html("BATAL").append($("<span>",{class:"fa fa-times"})).addClass("btn-batal"),a.form.renderTo("#content"),a.form.getItem("soal").setValue(a.content)},onSave:function(){if((s=this).form.isValid()){var t=$("<div>"),n=s.form.getValue("soal");t.append(n),t.find("img").each(function(a,t){"blob"==$(this).attr("src").substring(0,4)&&s.convertBase64($(this))});var s=this,e=$.extend({},{soal_id:s.current.soal_id,sekolah_id:s.current.sekolah_id,mapel_id:s.current.mapel_id,tingkat:s.current.tingkat,pertanyaan:t.html()});s.form.submit({url:a.save,data:e,success:function(a){s.loadSoal(s.current,$("#nomor-soal").find("a.active"))}})}},clearContent:function(){if("undefined"!=typeof tinymce&&tinymce.editors&&tinymce.editors.length>0)for(var a=tinymce.editors.length-1;a>=0;a--)tinymce.editors[a].remove();$("#content").empty()},convertBase64:function(a){var t,n=document.createElement("CANVAS"),s=n.getContext("2d"),e=a.get(0);n.height=e.naturalHeight,n.width=e.naturalWidth,s.drawImage(e,0,0),t=n.toDataURL("image/png"),a.attr("src",t)},listenJawaban:function(a,t,n){var s=this,e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=$("<audio>",{src:n.audio,autoplay:!1,controls:!0,controlsList:"nodownload"}),o=(t.find("ol").last(),!1);if(empty(n.audio)||t.prepend(i),s.content=t.html(),t.find("input[type=text]").each(function(a,t){$(this).addClass("jawaban-isian"),o=!0}),t.find("input[type=radio]").each(function(a,t){$(this).addClass("jawaban-radio"),o=!0}),t.find("input[type=checkbox]").each(function(a,t){$(this).addClass("jawaban-checkbox"),o=!0}),t.find("textarea").each(function(a,t){$(this).addClass("jawaban-essay"),o=!0}),t.find("img").each(function(a,t){$(this).parent().css("z-index")<0&&$(this).parent().css("z-index",1)}),t.find(".mce-exam-option").each(function(a,t){$(this).removeClass("mce-exam-option"),$(this).addClass("jawaban jawaban-mce"),void 0==$(this).attr("data-huruf")&&($(this).attr("data-huruf",e[a]),$(this).html(e[a])),a++,o=!0}),t.find('ol[type="A"]').last().find("li").length>=4&&t.find('ol[type="A"]').last().each(function(){var t=$(this).attr("start")-1||0;$(this).css("list-style-type","none"),$(this).css("padding-left","30px"),$(this).addClass("jawaban-wrapper"),$(this).attr("id","soal-jawaban"),$(this).find("li").each(function(){$(this).prepend('<a href="javascript:;" class="jawaban jawaban-mce jawaban-ol" data-huruf="'+e[t]+'">'+e[t]+"</a>"),t++,o=!0}),$(this).find("a").removeClass("active"),$(this).find('a[data-huruf="'+a.find("span").text()+'"]').addClass("active")}),1==n.images_soal||!o){var l=$("<div>",{class:"jawaban-img-container"}),c=$("<div>",{class:"jawaban-img-border"}),r=$("<div>",{class:"jawaban-img-title",text:"JAWABAN"}),d=$("<div>",{class:"jawaban-img-wrapper"}),h=void 0==n.images_option||empty(n.images_option)?5:parseInt(n.images_option);h=h<=0?5:h,l.append(c.append(r).append(d));for(var f=0;f<h;f++)d.append($("<a>",{href:"javascript:;",class:"jawaban-mce jawaban",text:e[f],"data-huruf":e[f]}));t.append(l)}t.find("a.jawaban").removeClass("active"),t.find('a.jawaban[data-huruf="'+a.find("span").text()+'"]').addClass("active"),$(".jawaban").off("click"),$(".jawaban").on("click",function(){s.save($(this).data("huruf"))})},show:function(){this.soal=[],this.start()}}}();Reading.show();