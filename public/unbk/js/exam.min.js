var Exam=function(){var t,a=baseURL+"siswa/exam/",n={soal:a+"soal",files:a+"files",save:a+"save",skoring:a+"skoring",result:a+"result",content:a+"content",image:baseURL+"siswa/soal/image"},s=0,i=0,e=0,o=0;return{soal:[],center:function(t){"function"==typeof t.hasClass&&t.hasClass("modal")&&((t.length?t:$(".modal-vcenter:visible")).each(function(t){var a=$(this).clone().css("display","block").appendTo("body"),n=Math.round((a.height()-a.find(".modal-content").height())/2);n=n>0?n:0,a.remove(),$(this).find(".modal-content").css("margin-top",n)}),$(window).on("resize",this.center))},createComponent:function(){this.soal=[]},countdown:function(){var a=this;t=setInterval(function(){var n=$("#timer");if(o>=60&&a.saveTime(),e<=0&&i<=0&&s<=0)return n.html("Selesai"),clearInterval(t),void a.skoring();0==s?i>0?(i--,s=59):e>0&&(i=59,s=59,e--):s--;var l=e<10?"0"+e:e,d=i<10?"0"+i:i,c=s<10?"0"+s:s;n.html(l+":"+d+":"+c),o++},1e3)},eventListener:function(){var t=this;$("#font-small").click(function(){$(".soal-container").removeClass("zoom-1"),$(".soal-container").removeClass("zoom-2")}),$("#font-middle").click(function(){$(".soal-container").addClass("zoom-1"),$(".soal-container").removeClass("zoom-2")}),$("#font-big").click(function(){$(".soal-container").removeClass("zoom-1"),$(".soal-container").addClass("zoom-2")}),$("#soal-back").click(function(){var t=$("#page").text()-1,a=t-1;$("#page-count").text();t>0&&$("#nomor-soal a:eq("+a+")").click()}),$("#soal-next").click(function(){var t=$("#page").text()-1+1;t<$("#page-count").text()&&$("#nomor-soal a:eq("+t+")").click()}),$("#soal-ragu").click(function(){var a=$(this).find(".check-ragu"),n=$("#nomor-soal").find("a.active"),s=n.find(".soal-nomor-link-jawab").text();a.toggleClass("active"),n.toggleClass("ragu"),t.save(s)}),$("#right-nav-button").click(function(){$("#right-nav").hasClass("show")?($("#right-nav").removeClass("show"),$(this).find(".fa").removeClass("fa-chevron-right"),$(this).find(".fa").addClass("fa-chevron-left")):($("#right-nav").addClass("show"),$(this).find(".fa").removeClass("fa-chevron-left"),$(this).find(".fa").addClass("fa-chevron-right"))}),$("#soal-selesai").click(function(){var a=$("#nomor-soal").find("a.ragu").length,n=0,s="";if($("#nomor-soal").find("a").each(function(t){empty($(this).find("span").text())&&n++}),a>0)s='\n\t\t\t\t\t\t<div class="modal fade modal-vcenter dialog" tabindex="-1" role="dialog" aria-labelledby="confirmModal">\',\n\t\t\t\t\t\t\t<div class="modal-dialog modal-md" style="max-width:400px">\n\t\t\t\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t\t\t\t<h4 class="modal-title">Konfirmasi</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-2">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="fa fa-exclamation-triangle" style="font-size: 35px"></span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-10">\n\t\t\t\t\t\t\t\t\t\t\t\tMasih ada jawaban ragu-ragu,\n\t\t\t\t\t\t\t\t\t\t\t\tsilahkan hilangkan ceklis jawaban ragu-ragu untuk Selesai\n\t\t\t\t\t\t\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t\t\t\t\t\t\t<button type="button" id="btnTidak" class="btn btn-success w-100">OK</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>';else s='\n\t\t\t\t\t\t<div class="modal fade modal-vcenter dialog" tabindex="-1" role="dialog" aria-labelledby="confirmModal">\',\n\t\t\t\t\t\t\t<div class="modal-dialog modal-md" style="max-width:400px">\n\t\t\t\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t\t\t\t<h4 class="modal-title">Konfirmasi</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-2">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="fa fa-exclamation-triangle" style="font-size: 35px"></span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-10">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="kosong"></span>\n\t\t\t\t\t\t\t\t\t\t\t\tApakah anda yakin akan mengakhiri mata ujian ini ?\n\t\t\t\t\t\t\t\t\t\t\t\tsetelah ke mata uji berikutnya anda tidak bisa kembali ke mata uji sebelumnya\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="checkbox mt-3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label style="font-size: 12px">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox" id="cekOk" style="margin-right: 10px"> Centang kemudian tekan tombol selesai,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanda tidak akan kembali ke soal jika sudah menekan tombol selesai\n\t\t\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-6"><button type="button" id="btnSelesai" class="btn btn-success w-100">SELESAI</button></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-6"><button type="button" id="btnTidak" class="btn btn-danger w-100">TIDAK</button></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>';s=$(s);var i=$("<div>",{class:"modal-backdrop fade"});n&&s.find(".kosong").html("Masih ada "+n+" soal belum dijawab, <br>"),$("body").addClass("modal-open"),$("body").append(i),$("body").append(s),i.addClass("show"),s.show(),s.addClass("show"),s.find("#btnSelesai").click(function(){$("#cekOk").is(":checked")&&(t.skoring(),s.find("#btnTidak").click())}),s.find("#btnTidak").click(function(){s.removeClass("show"),i.removeClass("show"),setTimeout(function(){s.remove(),i.remove(),$("body").removeClass("modal-open")},200)}),t.center(s)})},skoring:function(){$.ajax({dataType:"json",type:"POST",url:n.skoring,success:function(t){t.success&&($(".exam").css("position","static"),$(".exam").load(n.result,function(){$("#btnLogoutTes").click(function(){$("#btnLogout").click()})}))}})},saveTime:function(){var t=3600*e+60*i+s,a=$("#nomor-soal").find("a.active").data("tes-id");$.ajax({dataType:"json",type:"POST",url:n.save,data:{tes_id:a,remaining_time:t},global:!1,success:function(t){o=0}})},saveEssay:function(t){var a="";$("#content").find("input[type=text],textarea").each(function(t,n){a+=$(this).val()+","}),""!=a&&(a=a.substring(0,a.length-1)),this.save(a,t,!0)},save:function(t,a,l){a=a||null,l=l||!1;var d=$("#nomor-soal"),c=d.find("a.active").data("soal-id"),r=d.find("a.active").data("tes-id"),u=$("#soal-ragu").find(".check-ragu").hasClass("active")?"1":"",h=3600*e+60*i+s;$.ajax({dataType:"json",type:"POST",url:n.save,data:{tes_id:r,soal_id:c,jawaban:t,ragu:u,remaining_time:h,save_answer:1,essay:l?1:""},success:function(n){n.success?(l||($("a.jawaban").removeClass("active"),$('a.jawaban[data-huruf="'+t+'"]').addClass("active"),d.find("a.active").find("span").text(t)),d.find("a.active").addClass("isi"),o=0,$("#notifikasi").text(n.msg),$("#notifikasi").addClass("show")):($("#notifikasi").text(n.msg),$("#notifikasi").addClass("show")),setTimeout(function(){$("#notifikasi").removeClass("show")},3e3),null!=a&&a.call()}})},loadSoal:function(t,a){var s=this;$.ajax({dataType:"json",type:"POST",url:n.content,data:{soal_id:t.soal_id},success:function(t){if(t.success){var i=$("<div>",{class:"soal-container mce-content-body"});if("1"==t.images_soal){var e=$("<img>",{src:app.uri(n.image,{mapel_id:t.mapel_id,tingkat:t.tingkat,filename:t.filename}),onload:"this.width/=1.3;this.onload=null;",alt:"Loading Images........"});i.html(e),$("#content").html(i)}else $("#content").html(i.html(t.pertanyaan));s.listenJawaban(a,i,t)}}})},start:function(){var t=this;$(window).on("contextmenu",function(){return!1}),$(window).keydown(function(a){var n=a.which;37==n?($("#content").find("input[type=text],textarea").length>0&&t.saveEssay(),$("#soal-back").click()):39==n?($("#content").find("input[type=text],textarea").length>0&&t.saveEssay(),$("#soal-next").click()):65==n?$('a.jawaban[data-huruf="A"]').click():66==n?$('a.jawaban[data-huruf="B"]').click():67==n?$('a.jawaban[data-huruf="C"]').click():68==n?$('a.jawaban[data-huruf="D"]').click():69==n&&$('a.jawaban[data-huruf="E"]').click()}),$.ajax({dataType:"json",type:"POST",url:n.soal,success:function(a){a.success?(e=a.tes.jamSisa,i=a.tes.menitSisa,s=a.tes.detikSisa,e<=0&&i<=0&&(s=0),t.countdown(),t.soal=a.soal,$.each(a.soal,function(t,a){var n=$("<a>",{href:"javascript:void(0)",class:"soal-nomor-link","data-index":t,"data-no":a.nomor,"data-soal-id":a.soal_id,"data-tes-id":a.tes_id}).text(a.nomor);if(-1===a.jawaban.search(/[^A-Z]+/))var s=$("<span>",{class:"soal-nomor-link-jawab"}).text(a.jawaban);else s=$("<span>",{class:"soal-nomor-link-jawab"});"1"==a.ragu&&n.addClass("ragu"),""!=a.jawaban&&n.addClass("isi"),n.append(s),n=$("<li>").append(n),$("#nomor-soal").append(n)}),$("#nomor-soal a").click(function(a){var n=$(this),s=$(this).data("index"),i=t.soal[s];$("#nomorSoal").modal("hide"),$("#page").text(i.nomor),$(".soal-nomor-link").removeClass("active"),$(this).addClass("active"),$(this).hasClass("ragu")?$("#soal-ragu").find(".check-ragu").addClass("active"):$("#soal-ragu").find(".check-ragu").removeClass("active"),s+1==t.soal.length?($("#soal-next").hide(),$("#soal-selesai").show()):($("#soal-next").show(),$("#soal-selesai").hide()),t.loadSoal(i,n)}),$("#nomor-soal a:first").click(),$("#page-count").text(t.soal.length),t.eventListener()):t.skoring()}})},listenJawaban:function(t,a,n){var s=this,i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e=$("<audio>",{src:n.audio,autoplay:!1,controls:!0,controlsList:"nodownload"}),o=(a.find("ol").last(),!1);if(empty(n.audio)||a.prepend(e),a.find("input[type=text]").each(function(t,a){var i=n.answer.split(",");i.length>=t&&$(this).val(i[t]),$(this).addClass("jawaban-isian"),$(this).blur(function(){s.saveEssay(null)}),o=!0}),a.find("input[type=radio]").each(function(t,a){$(this).addClass("jawaban-radio"),o=!0}),a.find("input[type=checkbox]").each(function(t,a){$(this).addClass("jawaban-checkbox"),o=!0}),a.find("textarea").each(function(t,a){var i=n.answer.split(",");i.length>=t&&$(this).val(i[t]),$(this).addClass("jawaban-essay"),$(this).blur(function(){s.saveEssay(null)}),o=!0}),a.find("img").each(function(t,a){$(this).parent().css("z-index")<0&&$(this).parent().css("z-index",1)}),a.find(".mce-exam-option").each(function(t,a){$(this).removeClass("mce-exam-option"),$(this).addClass("jawaban jawaban-mce"),void 0==$(this).attr("data-huruf")&&($(this).attr("data-huruf",i[t]),$(this).html(i[t])),t++,o=!0}),a.find('ol[type="A"]').last().find("li").length>=4&&a.find('ol[type="A"]').last().each(function(){var a=$(this).attr("start")-1||0;$(this).css("list-style-type","none"),$(this).css("padding-left","30px"),$(this).addClass("jawaban-wrapper"),$(this).attr("id","soal-jawaban"),$(this).find("li").each(function(){$(this).prepend('<a href="javascript:;" class="jawaban jawaban-mce jawaban-ol" data-huruf="'+i[a]+'">'+i[a]+"</a>"),a++,o=!0}),$(this).find("a").removeClass("active"),$(this).find('a[data-huruf="'+t.find("span").text()+'"]').addClass("active")}),1==n.images_soal||!o){var l=$("<div>",{class:"jawaban-img-container"}),d=$("<div>",{class:"jawaban-img-border"}),c=$("<div>",{class:"jawaban-img-title",text:"JAWABAN"}),r=$("<div>",{class:"jawaban-img-wrapper"}),u=void 0==n.images_option||empty(n.images_option)?5:parseInt(n.images_option);u=u<=0?5:u,l.append(d.append(c).append(r));for(var h=0;h<u;h++)r.append($("<a>",{href:"javascript:;",class:"jawaban-mce jawaban",text:i[h],"data-huruf":i[h]}));a.append(l)}a.find("a.jawaban").removeClass("active"),a.find('a.jawaban[data-huruf="'+t.find("span").text()+'"]').addClass("active"),$(".jawaban").off("click"),$(".jawaban").on("click",function(){s.save($(this).data("huruf"))})},show:function(){this.createComponent(),this.start()}}}();Exam.show();